Это инструкция для Ubuntu (Linux) о том как установить и настроить программу **DNSCRYPT** для шифрования DNS запросов и использовать независимые DNS сервера с DNS записями собранными активистами и в теории не содержащими **рекламы** или каких-то **блокированных** DNS записей.

# Что такое DNS CRYPT (DNSCRYPT)?

**DNSCRYPT** - это программа, работает как прокси для DNS запросов, которые отправляются программами на сервера провайдера (или другие указанные в настройках сервера) и по имени сайта получают его IP чтобы знать куда идти.

# Почему это нужно использовать?

Провайдеры через их DNS сервера или сторонние DNS сервера **могут** использовать DNS чтобы **отслеживать** пользователя, **блокировать сайты** (возвращая неверный ответ), **показывать рекламу** (возвращая IP сайтов с рекламой). Отслеживать и блокировать они могут и по IP, но через DNS это проще.

# Как установить и настроить DNS CRYPT

1. Скачать последнюю версию отсюда `https://github.com/jedisct1/dnscrypt-proxy/releases` и распаковать в `/opt/dnscrypt-proxy/`
   * **Почему я не предлагаю устанавливать из PPA для Ubuntu, который указан на сайте разработчика:** потому что PPA неофициальный и вызывает сомнения, а просто скачать и запустить программу не так сложно чтобы идти на риск. Этот PPA не такой популярный как у более распространенных программ, поэтому если появятся вредоносные вставки, то они будут выявлены с большой задержкой.
2. Переименовать файл `/opt/dnscrypt-proxy/example-dnscrypt-proxy.toml` в `/opt/dnscrypt-proxy/dnscrypt-proxy.toml`
3. в файле `dnscrypt-proxy.toml` найти поиском и установить опции:
    ```toml
    doh_servers = false
    require_dnssec = true
    require_nolog = true
    require_nofilter = true
    ignore_system_dns = true
    ```
4. Раскомментировать и установить опцию `server_names` (убрав решетки перед ней) и установить ей значения:  `server_names = ['scaleway-fr', 'bottlepost-dns-nl', 'dnscrypt.nl-ns0']`  
**где** строки: `'scaleway-fr', 'bottlepost-dns-nl', 'dnscrypt.nl-ns0'` - это имена серверов из списка https://dnscrypt.info/public-servers/ (в файле настроек `dnscrypt-proxy.toml` прописан url на этот список в текстовом виде, а на сайте вид удобнее).
    * Можете выбирать  сервера из писка сами, нужно выбирать те для которых стоит в их описании: `dnssec`, `no log`, `no filter` (**dnssec** - расширение для шифрования DNS запросов, **no log** - не ведутся логи запросов, **no filter** - нет цензуры)
5. установить в настройках сети `Auto (ip only)` чтобы не подставляло dns сервер само и вписать в список dns серверов адрес `127.0.0.1`, порт **53** будет использован для DNS по умолчанию, его не нужно писать.
6. проверить на сайте https://browserleaks.com/ip какие dns сервера используются (нужно чтобы отображались те что в списке)
7. установить dnscrypt-proxy как сервис командой `sudo /opt/dnscrypt-proxy/dnscrypt-proxy -service install`
8. запустить dnscrypt-proxy как сервис командой (просто установить недостаточно, нужен запуск) `sudo /opt/dnscrypt-proxy/dnscrypt-proxy -service start`
9. После перезагрузки сервис уже будет работать, его не нужно добавлять в авто загрузку вручную. Проверить работает или нет можно командой `systemctl status dnscrypt-proxy`

**Остановить** этот сервис можно командой `sudo /opt/dnscrypt-proxy/dnscrypt-proxy -service stop`

Чтобы DNS **заработало** если не запущен dnscrypt нужно удалить установленный по этой инструкции адрес `127.0.0.1` DNS сервера из настроек сети.

Предлагаю **выбирать сервера** с текстом в названиях: `.nl, -nl, -fr, .fr` это сервера Нидерландов или Франции. (используйте поиск `ctrl+F` по странице чтобы найти такие записи)